---
import SocialIcon from "@components/SocialIcon.astro";
import Tag from "@components/Tag.astro";
import BaseLayout from "@layouts/BaseLayout.astro"
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import Works from "@components/Works.astro";

import GithubIcon from "@assets/github.svg";
import LinkIcon from "@assets/link.svg";

const { frontmatter } = Astro.props;
let thumbnail;
if(frontmatter.thumbnail != null) {
    const thumbnailPath = `/src/assets/works/${frontmatter.thumbnail}`;
    const thumbnails = import.meta.glob<{ default: ImageMetadata }>("/src/assets/works/*.png", { eager: true });
    if(!thumbnails[thumbnailPath]) {
        throw new Error(`Thumbnail ${thumbnailPath} not found`);
    }
    thumbnail = thumbnails[thumbnailPath].default;
}else {
    thumbnail = undefined;
}
---

<BaseLayout pageTitle={frontmatter.title}>
    <div class="w-full min-h-screen flex flex-col justify-between">
        <div class="pt-12 mb-8 min-h-[50vh] flex flex-col md:flex-row-reverse">
            <div class="md:max-w-192 md:w-[50%] md:ml-8">
                {
                    thumbnail != null ?
                    <Image class="w-full h-full object-contain aspect-video" alt={`${frontmatter.title}のサムネ`} src={thumbnail} fit="contain" /> :
                    <div class="aspect-video border-4 border-white/50 border-dashed flex items-center justify-center text-4xl">のいまげ</div>
                }
            </div>
            <div class="flex-1">
                <h1 class="text-3xl sm:text-5xl font-bold mb-8 mt-4 sm:mt-0">{frontmatter.title}</h1>
                {(frontmatter.github || frontmatter.site) && (<div class="h-8 my-4 flex gap-2">
                    {frontmatter.github && <SocialIcon image={GithubIcon} url={frontmatter.github} name="github" /> }
                    {frontmatter.site && <SocialIcon image={LinkIcon} url={frontmatter.site} name="site" /> }
                </div>)
                }
                <div class="space-y-4 min-h-48 wrap-normal markdown">
                    <slot />
                </div>
                <div class="flex gap-2">
                    {frontmatter.tags.map((tag: string) => <Tag tag={tag} />)}
                </div>
                <p>公開日: {frontmatter.pubDate.toString().slice(0, 10)}</p>
            </div>
        </div>
        <Works selected_work={frontmatter.title} />
    </div>
</BaseLayout>
<style is:global>
    .markdown a {
        color: lightblue;
        text-decoration: underline;
    }
</style>
